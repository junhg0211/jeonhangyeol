# 디스코드 봇 명령어 목록

이 봇은 경제(소지금·아이템), 경매, 활동 지수, 투자(ETF), 설정 기능을 제공합니다. 모든 슬래시 명령은 한국어 기준이며, 일부는 서버 관리자 권한이 필요합니다.

- 실행: `python3 __main__.py`
- 토큰: 프로젝트 루트의 `bot_token.txt`에 디스코드 봇 토큰 저장
- 드라이런(로그인 없이 점검): `DRY_RUN=1 python3 __main__.py` 또는 `python3 __main__.py --dry-run`
- DB: `data.sqlite3` (루트)

## 공통 동작
- 페이지네이션: 목록/랭킹은 메시지에 ⬅️ ➡️ 반응으로 페이지 이동(1분 후 만료)
- 시간대: 한국시간(KST) 기준
- 관리자 권한이 필요한 명령은 “관리 서버 권한(Manage Guild)”이 있어야 노출/실행됩니다.

---

## 경제/소지금
- `/돈 확인` — 내 소지금 확인
- `/돈 순위 [상위]` — 소지금 랭킹(서버 닉네임 표시, 페이지네이션)
- `/송금 받는사람 금액` — 다른 유저에게 송금

## 인벤토리/아이템
- `/인벤토리 [유저] [검색]` — 인벤토리 조회(검색/페이지네이션)
- `/양도 받는사람 아이템 수량` — 자동완성에서 선택한 아이템을 다른 유저에게 전달
- `/폐기 아이템 수량` — 자동완성에서 선택한 아이템을 버림
- `/지급 대상 이모지 이름 [수량]` — 관리자 전용, 테스트/운영용 아이템 지급
  - 주의: 투자 종목 아이템(ETF_*/IDX_*)은 /양도·/폐기에서 숨겨지며, 이전/폐기할 수 없습니다. 매매는 /투자 명령으로만 가능합니다.

## 경매
그 길드(서버) 단위로 동작합니다.
- `/경매 출품 아이템 수량 시작가 기간시간` — 보유 아이템을 경매에 출품(1–720시간)
- `/경매 입찰 경매id 금액` — 입찰(선결제, 기존 최고가 환불)
- `/경매 목록 [검색] [페이지크기]` — 진행중 경매 목록(페이지네이션)
- 마감 처리: 백그라운드 작업이 30초마다 정산
  - 낙찰 시: 승자에게 아이템 지급, 판매자에게 대금 입금
  - 유찰 시: 판매자에게 아이템 반환
  - 판매자가 서버에 없으면 파기 처리
- 알림: 
  - 새 경매/마감 결과는 “알림 채널”로 통지(설정 시)

## 특허 미니게임
- `/특허 참가` — 특허 게임에 참가
- `/특허 하차` — 특허 게임에서 하차
- `/특허 출원 단어 가격` — 단어 특허 출원(짧을수록 최소 출원가가 큼)
  - 최소 출원가 규칙(기본값):
    - 1–2글자 ≥ 5,000원, 3글자 ≥ 3,000원, 4글자 ≥ 1,500원, 5글자 ≥ 800원, 6글자 이상 ≥ 400원
- `/특허 목록` — 등록된 특허 목록 보기
- `/특허 취소 단어` — 내 특허 취소
- `/특허 로그 [유저] [상위]` — 최근 특허 검출(과금/검열) 내역 확인
- 만료/자동 경매
  - 특허는 최대 14일까지만 보유할 수 있으며, 만료되면 자동으로 경매에 올라갑니다(기간 30일, 시작가 1원).
- 사용료 징수/검열
  - 게임 참가자가 메시지에 출원된 단어를 포함하면 사용료를 특허권자에게 지불합니다(메시지당 단어별 1회). 사용료는 해당 특허의 출원가의 1/50입니다(최소 1원).
  - 잔액이 부족하면 해당 단어가 디스코드 스포일러(`||단어||`) 형식으로 숨겨진 메시지로 대체됩니다. 봇이 원문을 삭제 후 검열 버전을 안내합니다(권한 없을 시 답글로 안내).
- 인벤토리: 특허는 인벤토리 아이템으로 보유되며(`📜 특허:<단어>`), 일반 아이템 명령으로 이전/폐기할 수 있습니다.
  - 주의: 일반 아이템으로 폐기하면 특허가 취소되며, 이전하면 특허 소유권도 함께 이전됩니다.

## 활동 지수(채팅/통화/반응)
- `/지수 확인` — 현재 지수 표시
- `/지수 규칙` — 산정 기준 텍스트로 확인
- 집계: 매일 KST 09:00–21:00, 1분 단위로 업데이트
- 변동 제한: 당일 개장가 대비 50%–200% 범위 내 클램프
- 알림: 급등락·신고점 알림은 기본 꺼짐(서버별로 설정 가능)

### 산정 기준(요약)
- 분당 입력: 채팅 수, 반응 수, 음성 참여 인원, 평균 채팅 간격(짧을수록 보너스)
- 가중치: 카테고리별로 채팅/반응/통화 가중합 + 간격 보너스
- 상대 비교: 최근 5분 활동을 “정확히 1시간 전의 동일 길이 구간”과 비교하여, 현재가 더 활발하면 상승 가중(최대 +20%), 덜 활발하면 축소(최소 −20%)
- 분당 변동: (점수−1)/S(=8.0)에 상대 가중을 곱하고, 이후 분당 감쇠 0.1%를 적용; 마지막으로 분당 ±2%로 제한
- 일중 범위: 당일 개장가 기준 하한 50%, 상한 200%로 클램프

## 투자(ETF)
지원 종목: `ETF_CHAT`(채팅), `ETF_VOICE`(통화), `ETF_REACT`(반응), `ETF_ALL`(종합)
- `/투자 시세` — 종목들의 현재가(지수 연동) 확인
- `/투자 보유` — 내 보유 종목·평단가·평가금액 확인
- `/투자 매수 종목 수량` — 시장가 매수(장이 닫혀 있으면 개장시장가 예약으로 전환)
- `/투자 매도 종목 수량` — 시장가 매도(장이 닫혀 있으면 개장시장가 예약으로 전환)
- `/투자 예약매수 종목 수량 지정가` — 지정가 매수 예약
- `/투자 예약매도 종목 수량 지정가` — 지정가 매도 예약
- `/투자 예약목록` — 내 예약 주문 조회
- `/투자 예약취소 주문번호` — 예약 주문 취소
- `/투자 차트 종목 단위 길이` — 분/시간/일/주 단위 봉차트 이미지(서버에 matplotlib 설치 필요)
- 시장 시간: KST 09:00–21:00에만 체결·차트 기록(분봉)

## 설정
- `/설정 알림채널 [채널]` — 봇 자동 알림(경매/지수 등)을 보낼 채널 설정/해제
- `/설정 지수알림 상태` — 활동 지수 알림 On/Off (기본 Off)

---

## 출석
- `/출석 하기` — 오늘 출석하고 보상 받기 (연속 n일 × 10원)
- `/출석 오늘 [상위]` — 오늘의 출석 현황(출석/미출석) 확인
- `/출석 최대연속 [상위]` — 최대 연속 출석 일수 리더보드
- 규칙
  - 한국시간(KST) 기준 매일 00:00에 날짜가 바뀝니다.
  - 연속 출석일수에 따라 보상은 10원, 20원, 30원… 식으로 증가합니다(분모 없이 단순 n×10원).
  - 리더보드의 미출석 목록은 “과거에 한 번이라도 출석한 적 있는 유저 중 오늘 미출석” 기준입니다.

## 권한/주의
- 슬래시 명령 동기화: 봇 준비(on_ready) 시 전체/길드 동기화. 새 명령은 길드 동기화로 즉시 표시됩니다.
- 봇 권한: 애플리케이션 명령 사용, 메시지 보내기/임베드/반응 추가 권한 필요
- 비밀 정보: `bot_token.txt`는 .gitignore 처리됨

## 개발 팁
- 코그 자동 로드: `cogs/*.py`
- 드라이런: 코그/명령 로드만 확인(네트워크 미로그인)
- 데이터 파일: SQLite `data.sqlite3` (백업 주의)
